# Реализация оценочной тренировки

## Общее описание

Функция "Оценочная тренировка" реализована как отдельный компонент Svelte (`AssessmentTraining.svelte`) и интегрирована в существующую архитектуру приложения SARAYLO. Эта функция позволяет пользователю определить персональные зоны интенсивности на основе реальных данных, собранных во время 20-минутной тренировки.

## Архитектура и алгоритм функции

### Этап 1: Подготовка и инициализация

На этом этапе происходит запуск тренировки и формирование ее структуры:

**Параметры тренировки:**
- Длительность: 20 минут
- 5 зон интенсивности с цветовым кодированием:
  - Синяя зона (#00BFFF): 6 минут
  - Зеленая зона (#18FF00): 5 минут
  - Жёлтая зона (#FFFC00): 5 минут
  - Оранжевая зона (#FF8800): 3 минуты
  - Красная зона (#9B0000): 1 минута

**Интерфейс подготовки:**
- Отображение всех параметров тренировки
- Визуализация расписания зон с цветовой индикацией
- Кнопка "Начать оценочную тренировку"

### Этап 2: Выполнение тренировки

В течение 20-минутного периода система находится в режиме активного сбора и анализа данных:

**Таймер и навигация:**
- Реальное время с обратным отсчетом
- Автоматические переходы между зонами
- Визуальная индикация текущей целевой зоны

**GPS интеграция:**
- Использование Mapbox для отслеживания местоположения
- Визуализация маршрута на карте в реальном времени
- Обработка ошибок геолокации

**Сбор данных:**
- Генерация скорости в зависимости от текущей зоны
- Применение фильтра Калмана для сглаживания данных
- Накопление данных о времени в каждой зоне

### Этап 3: Обработка результатов

По истечении 20 минут тренировка завершается и система приступает к расчету ключевых показателей:

**Расчет процентилей:**
- Сортировка всех собранных значений скорости
- Определение 20-го и 80-го процентилей
- Использование этих значений как нижней и верхней границ

**Расчет зон интенсивности:**
- Зона 1 (0-15%): [LB, LB + 0.15 * Range]
- Зона 2 (16-25%): [LB + 0.15 * Range, LB + 0.25 * Range]
- Зона 3 (26-50%): [LB + 0.25 * Range, LB + 0.50 * Range]
- Зона 4 (51-75%): [LB + 0.50 * Range, LB + 0.75 * Range]
- Зона 5 (76-100%): [LB + 0.75 * Range, UB]

**Визуализация результатов:**
- Отображение границ каждой зоны в км/ч
- График времени, проведенного в каждой зоне
- Рекомендации по использованию зон

## Методология определения и адаптации зон интенсивности

Реализована научно обоснованная методология, которая:

- Использует реальные данные пользователя вместо абстрактных максимальных значений
- Применяет процентили (20-й и 80-й) для определения диапазона интенсивностей
- Автоматически адаптирует зоны к индивидуальному уровню подготовки пользователя
- Сохраняет результаты в localStorage для последующего использования

## Интеграция с другими функциями приложения

### Навигация
- Добавлена опция "Оценочная тренировка" в меню тренировок
- Реализована навигация между всеми разделами приложения
- Сохранена визуальная согласованность с остальным интерфейсом

### Хранение данных
- Результаты оценочной тренировки сохраняются в `localStorage`
- Данные доступны для использования другими компонентами приложения
- Формат хранения: JSON с полями `date`, `zones`, `lb`, `ub`, `speedData`

### Взаимодействие с компонентами
- **Training.svelte**: Добавлена навигация к оценочной тренировке через меню
- **App.svelte**: Добавлен маршрут для отображения компонента оценочной тренировки
- **Profile.svelte**: Может использовать результаты для персонализации рекомендаций

## Технические особенности реализации

### Фильтр Калмана
Для сглаживания данных о скорости и обеспечения стабильности показаний реализован фильтр Калмана:
```javascript
function applyKalmanFilter(measurement) {
    // Prediction step
    kalmanState = kalmanState;
    kalmanCovariance = kalmanCovariance + kalmanProcessNoise;
    
    // Update step
    const kalmanGain = kalmanCovariance / (kalmanCovariance + kalmanMeasurementNoise);
    kalmanState = kalmanState + kalmanGain * (measurement - kalmanState);
    kalmanCovariance = (1 - kalmanGain) * kalmanCovariance;
    
    return kalmanState;
}
```

### Адаптивный дизайн
- Полностью отзывчивый интерфейс для всех устройств
- Соответствие требованиям мобильной оптимизации
- Пропорциональное изменение размеров контейнеров

### Mapbox интеграция
- Использование Mapbox GL JS для отображения карты
- Отслеживание местоположения пользователя в реальном времени
- Визуализация маршрута во время тренировки

### Хранение данных
- Использование `localStorage` для сохранения результатов
- Структурированное хранение данных о зонах и скорости
- Возможность загрузки предыдущих результатов

## Расширяемость и будущие улучшения

### Интеграция с другими данными
- Возможность интеграции с данными пульса
- Поддержка данных о вариабельности сердечного ритма (HRV)
- Использование данных с беговых дорожек

### Периодизация тренировочного процесса
- Построение мезоциклов на основе определенных зон
- Адаптация планов тренировок к прогрессу пользователя
- Предотвращение стагнации и перетренированности

### Улучшенная аналитика
- Графики динамики прогресса
- Сравнение с эталонными данными
- Рекомендации по корректировке тренировок

## Использование в приложении

### Доступ к функции
1. Перейдите в раздел "Тренировка"
2. Откройте меню (три точки в правом верхнем углу)
3. Выберите "Оценочная тренировка"
4. Нажмите "Начать оценочную тренировку"

### Интерпретация результатов
- Используйте определенные зоны для планирования тренировок
- Следуйте модели 80/20: 80% времени в низких зонах, 20% в высоких
- Повторяйте оценочную тренировку каждые 4-6 месяцев для актуализации зон

## Заключение

Реализация оценочной тренировки предоставляет пользователям научно обоснованный инструмент для определения персональных зон интенсивности. Методология, основанная на процентилях реальных данных пользователя, обеспечивает индивидуализацию и долгосрочную ценность для каждого спортсмена. Интеграция с существующей архитектурой приложения позволяет легко расширять функционал и использовать результаты в других компонентах системы.