# Mobile Deployment with Capacitor

This document explains how to build and deploy the Quantum Consciousness Runner application as a native mobile app for Android and iOS using Capacitor.

## Prerequisites

Before building the mobile app, ensure you have the following installed:

1. Node.js (version 16 or higher)
2. npm (comes with Node.js)
3. Android Studio (for Android development)
4. Xcode (for iOS development, macOS only)
5. JDK 11 or higher

## Project Structure

The mobile project files are located in:
- `android/` - Android project files
- `ios/` - iOS project files
- `dist/` - Web build output (generated by Vite)

## Building the Web App

Before building the mobile app, you need to build the web application:

```bash
npm run build
```

This command generates the production build in the `dist/` directory.

## Syncing with Capacitor

After building the web app, sync the assets with the native platforms:

```bash
npm run cap:sync
```

This command copies the web assets to the native projects and updates native dependencies.

## Android Development

### Opening the Project

To open the Android project in Android Studio:

```bash
npm run cap:open:android
```

### Running on Device or Emulator

To run the app on a connected Android device or emulator:

```bash
npm run cap:run:android
```

### Permissions

The application requires specific permissions to function correctly on Android. These permissions are already configured in the [AndroidManifest.xml](file://e:/DevBuild/AI/AI%20Running/saraylo_web_app/android/app/src/main/AndroidManifest.xml) file:

- `ACCESS_COARSE_LOCATION` and `ACCESS_FINE_LOCATION` - for determining location
- `ACCESS_BACKGROUND_LOCATION` - for background geolocation functionality
- `POST_NOTIFICATIONS` - for sending notifications
- `WAKE_LOCK` and `SCHEDULE_EXACT_ALARM` - for background tasks
- `ACCESS_NETWORK_STATE` - for checking network status

When the application starts, it automatically requests the necessary permissions for geolocation and notifications.

### Building for Production

To build an APK for production:

1. Open the project in Android Studio
2. Select "Build" → "Generate Signed Bundle / APK"
3. Follow the wizard to create a signed APK

## iOS Development (macOS only)

### Opening the Project

To open the iOS project in Xcode:

```bash
npm run cap:open:ios
```

### Running on Device or Simulator

1. Open the project in Xcode
2. Select your target device (physical device or simulator)
3. Click the "Run" button or press Cmd+R

### Permissions

iOS permissions are handled through the Info.plist file. When using Capacitor plugins that require permissions, the necessary entries are automatically added to the Info.plist file during the sync process.

### Building for Production

1. Open the project in Xcode
2. Select "Product" → "Archive"
3. Follow the instructions in the Archive organizer to distribute the app

## Updating Native Dependencies

When you install new Capacitor plugins or update existing ones, run:

```bash
npm run cap:sync
```

This will update the native projects with the new plugin code.

## Troubleshooting

### Common Issues

1. **Plugins not working**: Make sure to run `npm run cap:sync` after installing new plugins
2. **White screen on startup**: Check that the `webDir` in `capacitor.config.ts` points to the correct build directory
3. **Permission errors**: Ensure your app has the necessary permissions configured in the native projects

### Android-Specific Issues

1. **Gradle sync failed**: Try "File" → "Sync Project with Gradle Files" in Android Studio
2. **Build errors**: Check that you're using a compatible version of Android Studio and SDK
3. **Permission dialog not showing**: Ensure that the permissions are properly declared in AndroidManifest.xml and that the app requests them at runtime

### iOS-Specific Issues

1. **CocoaPods errors**: Run `cd ios && pod install` to update pods
2. **Signing errors**: Ensure your Apple Developer account is properly configured in Xcode

## Customizing the Native Projects

You can customize the native projects directly:

- Android: Modify files in the `android/` directory
- iOS: Modify files in the `ios/` directory

Common customizations include:
- App name and ID
- Icons and splash screens
- Permissions
- Native dependencies
- Platform-specific code

## Adding Capacitor Plugins

To add a new Capacitor plugin:

1. Install the plugin:
   ```bash
   npm install @capacitor/plugin-name
   ```

2. Sync with native projects:
   ```bash
   npm run cap:sync
   ```

3. Import and use the plugin in your code:
   ```typescript
   import { PluginName } from '@capacitor/plugin-name';
   
   // Use the plugin
   const result = await PluginName.method();
   ```

## Additional Resources

- [Capacitor Documentation](https://capacitorjs.com/docs)
- [Android Development Documentation](https://developer.android.com/docs)
- [iOS Development Documentation](https://developer.apple.com/documentation/)